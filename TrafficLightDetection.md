# Traffic Light Detection
This document briefly describes how the traffic light detection model was trained. The traffic lights in the simulator are very different from on site so we had to infact build two models. We used tensorflow object detection api for signal detection. The api provides various pretrained models as well as a pipeline that can be used to train the models on new data over different classes. Various object detection models such as rfcn/faster\_rcnn were considered for the same but in the end because of latency we decided to use ssd\_inception\_coco. The on site model was trained using Bosch small traffic light dataset. The simulator model was trained using labeled data graciously provided by [Anthony Sarkis](https://medium.com/@anthony_sarkis/self-driving-cars-implementing-real-time-traffic-light-detection-and-classification-in-2017-7d9ae8df1c58). The model generation consisted of the following steps

1. Create TFRecord files. The object detection api expects the training data to be in TFRecord format
2. Configure the pipeline file. The relevant portions to configure are num\_classes(Since the bosch traffic light dataset actually has 13 classes while the simulator dataset has only 3), path to TF Record file and number of iterations as well as  some optimization related parameters
3. Run the training pipeline. The model was trained on a GTX 1070 GPU machine. While we did not achieve the accuracy as advertised on the object detection page, it was good enough in the simulator run. 
4. Export the trained model to a  frozen inference graph

One additional complication we faced was that Carla only has tensorflow 1.3 while we trained the models on tensorflow 1.8. The models are not forward compatible!. Downgrading is not an option as the object detection api works only with tensorflow>=1.4. We ended up using the approach listed [here](https://github.com/alex-lechner/Traffic-Light-Classification#1-the-lazy-approach). The basic idea is to install a seperate tensorflow environment with version 1.4 and export the inference graph in this environment(even if the graph was trained on a different version of tensorflow).
